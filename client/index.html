<h1 id="title"></h1>
<h2 id="currentTime"></h2>
<h3>Northbound Trains</h3>
<ol>
    <li id="n1"></li>
    <li id="n2"></li>
    <li id="n3"></li>
</ol>
<h3>Southbound Trains</h3>
<ol>
    <li id="s1"></li>
    <li id="s2"></li>
    <li id="s3"></li>
</ol>
<p id="updateTime"></p>

<script>
    const formatTime = (rawTime) => {
        const hours = rawTime.getHours();
        const minutes = "0" + rawTime.getMinutes();
        const seconds = "0" + rawTime.getSeconds();
        const formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
        return formattedTime;
    }

    const displayTime = () => {
        currentTimeRaw = new Date();
        return document.querySelector('#currentTime').innerHTML = `The current time is ${formatTime(currentTimeRaw)}`;
    }

    const displaySchedule = () => {
        fetch('/subway')
            .then(resp => resp.json())
            .then(data => {
                const schedule = { ...data.schedule };
                const northboundTrains = [...schedule['N']];
                const southboundTrains = [...schedule['S']];
                for (let i = 0; i < 3; i++) {
                    const northTrainTime = new Date(northboundTrains[i].departureTime * 1000);
                    document.querySelector(`#n${i + 1}`).innerHTML = `${northboundTrains[i].routeId} train departing at ${formatTime(northTrainTime)}`;
                    const southTrainTime = new Date(southboundTrains[i].departureTime * 1000);
                    document.querySelector(`#s${i + 1}`).innerHTML = `${southboundTrains[i].routeId} train departing at ${formatTime(southTrainTime)}`;
                }
                const updateTime = new Date();
                return document.querySelector('#updateTime').innerHTML = `Last updated at: ${formatTime(updateTime)}`;
            })
            .catch(err => {
                return err;
            })
    }

    window.onload = () => {
        document.querySelector("#title").innerHTML = `DeKalb Station Schedule`;
        displayTime();
        displaySchedule();
        setInterval(displayTime, 1000);
        setInterval(displaySchedule, 30000);
    }
</script>